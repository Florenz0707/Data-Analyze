{
  "openapi": "3.0.1",
  "info": {
    "title": "默认模块",
    "description": "",
    "version": "1.0.0"
  },
  "tags": [
    {
      "name": "Users"
    },
    {
      "name": "Sessions"
    },
    {
      "name": "LLM"
    }
  ],
  "paths": {
    "/api/users/register": {
      "post": {
        "summary": "注册",
        "deprecated": false,
        "description": "",
        "tags": [
          "Users"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/users/login": {
      "post": {
        "summary": "登录",
        "deprecated": false,
        "description": "",
        "tags": [
          "Users"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {
              "Authorization": {
                "example": "",
                "required": false,
                "description": "Bearer token -- api_key",
                "schema": {
                  "type": "string"
                }
              },
              "Cookie": {
                "example": "",
                "required": false,
                "description": "refresh_token",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": []
      }
    },
    "/api/refresh": {
      "post": {
        "summary": "刷新",
        "deprecated": false,
        "description": "刷新api_key",
        "tags": [
          "Users"
        ],
        "parameters": [
          {
            "name": "refresh_token",
            "in": "cookie",
            "description": "",
            "required": false,
            "example": "",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          }
        },
        "security": []
      }
    },
    "/api/sessions/history": {
      "get": {
        "summary": "获取会话历史",
        "deprecated": false,
        "description": "",
        "tags": [
          "Sessions"
        ],
        "parameters": [
          {
            "name": "session_id",
            "in": "query",
            "description": "会话ID",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HistoryOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      },
      "delete": {
        "summary": "清空会话历史",
        "deprecated": false,
        "description": "",
        "tags": [
          "Sessions"
        ],
        "parameters": [
          {
            "name": "session_id",
            "in": "query",
            "description": "会话ID",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/sessions": {
      "post": {
        "summary": "显式创建会话",
        "deprecated": false,
        "description": "根据session_id和api_key显式创建会话",
        "tags": [
          "Sessions"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SessionIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      },
      "delete": {
        "summary": "删除会话",
        "deprecated": false,
        "description": "根据session_id和api_key删除会话",
        "tags": [
          "Sessions"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SessionIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      },
      "get": {
        "summary": "获取会话列表",
        "deprecated": false,
        "description": "根据api_key获取用户会话列表",
        "tags": [
          "Sessions"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionListOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/llm/chat": {
      "post": {
        "summary": "聊天",
        "deprecated": false,
        "description": "若session_id不存在则会隐式创建；\nuse_history：\n1. auto：根据上下文进行相关度分析，仅插入相关度高的内容作为prompt\n2. on：不进行相关度分析，直接插入历史作为prompt\n3. off：不启用会话历史功能\n4. null：使用服务器端默认配置\n",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChatIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/llm/providers": {
      "get": {
        "summary": "获取模型提供方",
        "deprecated": false,
        "description": "获取可用的模型提供方。默认获取hf和ollama，以及本地配置文件中配置的远程提供方",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProvidersOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/llm/local_models": {
      "get": {
        "summary": "获取本地模型",
        "deprecated": false,
        "description": "获取服务器端transformers和ollama已下载的本地模型",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LocalModelsOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/llm/select": {
      "post": {
        "summary": "选择模型",
        "deprecated": false,
        "description": "选择模型，若选择本地模型提供方（transformers和ollama），则需提供合法的模型名称；\n若选择远程模型提供方，则不需要模型名称，由服务器端指定",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SelectLLMIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SelectLLMOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/llm/my": {
      "get": {
        "summary": "获取当前模型",
        "deprecated": false,
        "description": "获取用户当前使用的模型，包括提供方和模型名",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SelectLLMOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    },
    "/api/llm/extern": {
      "post": {
        "summary": "添加自定义模型",
        "deprecated": false,
        "description": "用户自定义模型上传",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/APIIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      },
      "get": {
        "summary": "获取自定义模型",
        "deprecated": false,
        "description": "获取用户自定义模型列表",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ModelsListOut"
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      },
      "delete": {
        "summary": "删除自定义模型",
        "deprecated": false,
        "description": "删去用户的自定义模型。其中model_name可以是alias",
        "tags": [
          "LLM"
        ],
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ModelIn"
              },
              "examples": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "message"
                  ]
                }
              }
            },
            "headers": {}
          }
        },
        "security": [
          {
            "bearer": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "LoginIn": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        },
        "required": [
          "username",
          "password"
        ]
      },
      "ChatIn": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string"
          },
          "user_input": {
            "type": "string"
          },
          "use_history": {
            "type": "string",
            "description": "auto | on | off",
            "nullable": true
          }
        },
        "required": [
          "user_input"
        ]
      },
      "ChatOut": {
        "type": "object",
        "properties": {
          "reply": {
            "type": "string"
          }
        },
        "required": [
          "reply"
        ]
      },
      "HistoryOut": {
        "type": "object",
        "properties": {
          "history": {
            "type": "string"
          }
        },
        "required": [
          "history"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          }
        },
        "required": [
          "error"
        ]
      },
      "ProvidersOut": {
        "type": "object",
        "properties": {
          "providers": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "providers"
        ]
      },
      "LocalModelsOut": {
        "type": "object",
        "properties": {
          "transformers": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "ollama": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "transformers",
          "ollama"
        ]
      },
      "SelectLLMIn": {
        "type": "object",
        "properties": {
          "provider": {
            "type": "string"
          },
          "model": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "provider"
        ]
      },
      "SelectLLMOut": {
        "type": "object",
        "properties": {
          "provider": {
            "type": "string"
          },
          "model": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "provider"
        ]
      },
      "SessionIn": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string"
          }
        },
        "required": [
          "session_id"
        ]
      },
      "SessionOut": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string"
          }
        },
        "required": [
          "session_id"
        ]
      },
      "SessionListOut": {
        "type": "object",
        "properties": {
          "sessions": {
            "type": "array",
            "items": {
              "type": "string",
              "description": "session_id"
            }
          }
        },
        "required": [
          "sessions"
        ]
      },
      "APIIn": {
        "type": "object",
        "properties": {
          "base_url": {
            "type": "string"
          },
          "model_name": {
            "type": "string"
          },
          "api_key": {
            "type": "string"
          },
          "alias": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "base_url",
          "model_name",
          "api_key"
        ]
      },
      "ModelsListOut": {
        "type": "object",
        "properties": {
          "models_list": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "models_list"
        ]
      },
      "ModelIn": {
        "type": "object",
        "properties": {
          "model_name": {
            "type": "string",
            "description": "model_name或alias"
          }
        },
        "required": [
          "model_name"
        ]
      }
    },
    "securitySchemes": {
      "bearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "servers": [],
  "security": []
}